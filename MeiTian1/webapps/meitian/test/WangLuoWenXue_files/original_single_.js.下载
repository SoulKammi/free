define("ddbase",["jquery","underscore"],function(a,b){var c=c||{};return c.header_trim=function(a){return a.replace(/(\s*$)|(^\s*)/g,"")},c.getCookie=function(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?decodeURIComponent(escape(b[2])):null},c.token=function(){var a=c.getCookie("sessionID");return null===a&&(a=""),a},c.setCookie=function(a,b,c,d){var e=new Date;e.setTime(e.getTime()+60*c*60*1e3),document.cookie=d?a+"="+escape(b)+";Domain="+d+";path=/;expires="+e.toGMTString():a+"="+escape(b)+";Domain=dangdang.com;path=/;expires="+e.toGMTString()},c.delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var d=c.getCookie(a);null!=d&&(document.cookie=a+"="+d+";expires="+b.toGMTString()+"; path=/;Domain=dangdang.com")},c.setData=function(a,b,d){var b=encodeURIComponent(b);if(window.localStorage){window.localStorage.setItem(a,b)}else c.setCookie(a,b,d)},c.getData=function(a){if(window.localStorage){var b=window.localStorage;return b.getItem(a)?decodeURIComponent(b.getItem(a)):null}c.getCookie(a)},c.delData=function(a){if(window.localStorage){window.localStorage.removeItem(a)}else c.delCookie(a)},c.dateFormat=function(a,b){var c=b,d=new Date(a),e={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"q+":Math.floor((d.getMonth()+3)/3),S:d.getMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(d.getFullYear()+"").substr(4-RegExp.$1.length)));for(var f in e)new RegExp("("+f+")").test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?e[f]:("00"+e[f]).substr((""+e[f]).length)));return c},c.randomNumeric=function(a){for(var b="",c=a,d=0;d<c;d++)b+=Math.floor(10*Math.random());return b},c.generateGuid=function(){var a="",b=(new Date).getTime();return b=b.substring(b.length()-3,b.length()),a=c.dateFormat(new Date,"yyyyMMddHHmmss")+b+c.randomNumeric(6)+c.randomNumeric(6)+c.randomNumeric(6),a.toString()},c.getQueryString=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):null},c.loadJsFiles=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",b),a.append(c)},c.UUID=function(){this.id=this.createUUID()},c.UUID.prototype={valueOf:function(){return this.id},toString:function(){return this.id},createUUID:function(){var a=this,b=new Date(1582,10,15,0,0,0,0),c=new Date,d=c.getTime()-b.getTime();return a.getIntegerBits(d,0,31)+a.getIntegerBits(d,32,47)+(a.getIntegerBits(d,48,59)+"1")+a.getIntegerBits(a.rand(4095),0,7)+a.getIntegerBits(a.rand(4095),0,7)+(a.getIntegerBits(a.rand(8191),0,7)+a.getIntegerBits(a.rand(8191),8,15)+a.getIntegerBits(a.rand(8191),0,7)+a.getIntegerBits(a.rand(8191),8,15)+a.getIntegerBits(a.rand(8191),0,15))},getIntegerBits:function(a,b,c){var d=this.returnBase(a,16),e=new Array,f="",g=0;for(g=0;g<d.length;g++)e.push(d.substring(g,g+1));for(g=Math.floor(b/4);g<=Math.floor(c/4);g++)e[g]&&""!=e[g]?f+=e[g]:f+="0";return f},returnBase:function(a,b){return a.toString(b).toUpperCase()},rand:function(a){return Math.floor(Math.random()*(a+1))}},c.getUserName=function(){var b=c.getCookie("MDD_username");return null==b&&a.ajax({method:"GET",url:"/media/api2.go?action=getUser&selfType=0&pubId=5&rewardIcon="+c.setBaseApiParams(),async:!1,success:function(a){if(0==parseInt(a.status.code)){var d=a.data.userInfo;c.setCookie("MDD_username",d.nickName,8760),c.setCookie("MDD_custId",d.pubCustId,8760),b=d.nickName}}}),b},c.getCustId=function(){return!(!c.token()||null==c.token())&&(a.ajax({method:"GET",url:"/media/api2.go?action=getUser&selfType=0&pubId=5&rewardIcon="+c.setBaseApiParams(),async:!1,success:function(a){if(0==parseInt(a.status.code)){var b=a.data.userInfo;custId=decodeURIComponent(b.pubCustId)}}}),custId)},c.setBaseApiParams=function(){var a=c.getQueryString("channelId");null==a&&(a=7e4);var b=c.getCookie("__permanent_id");return null==b&&(b=""),"&deviceSerialNo=html5&macAddr=html5&channelType=html5&permanentId="+b+"&returnType=json&channelId="+a+"&clientVersionNo=5.8.4&platformSource=DDDS-P&fromPlatform=106&deviceType=pconline&token="+c.token()},c.baseApiParams=c.setBaseApiParams(),c.template=function(a,c){return b.template(a)(c)},c.dealTime=function(a){if(void 0==a)return"";var a=parseInt(a),b=(new Date).getTime()-a;if(b>0){if(b-864e5>0){var c=new Date(a);return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()}var d=b/1e3;if(parseInt(d/60)<60)return parseInt(d/60)+"分钟前";var e=Math.floor(d/3600);return e+"小时"+parseInt((d-3600*e)/60)+"分钟前"}return"0分钟前"},c.newDealTime=function(a){function b(a){return 1===(a+"").length?"0"+a:a}function c(){var a=new Date;return 1e3*(3600*a.getHours()+60*a.getMinutes()+a.getSeconds())}if(!a)return"";var d=parseInt(a),a=new Date(d),e=new Date,f=e.getTime(),g=a.getFullYear(),h=e.getFullYear(),i=a.getMonth()+1,j=a.getDate(),k=a.getHours(),l=a.getMinutes();if(g<h)return b(g)+"-"+b(i)+"-"+b(j);var m=c();return f-d<m?"今天 "+b(k)+":"+b(l):f-d>m&&f-d<m+864e5?"昨天"+b(k)+":"+b(l):b(i)+"-"+b(j)},c.leaveTime=function(a){var a=parseInt(a);if(isNaN(a)||!a)return 0;var b=a-(new Date).getTime();if(b<=0)return 0;var c=864e5,d=36e5,e=6e4,f=1e3;return b>=c?parseInt(b/c)+"天":b>=d?parseInt(b/d)+"小时":b>=e?parseInt(b/e)+"分钟":b>=f?parseInt(b/f)+"秒":void 0},c.getBookUrl=function(a){var b=a.mediaType||a.bookType;if(!b)return null;var c="";switch(b){case 1:case 2:case 4:a.saleId&&a.mediaId&&(c="./products/"+a.saleId+".html");break;case 3:a.productId&&(c="http://product.dangdang.com/"+a.productId+".html")}return c},c.joinBar=function(b){a.get("/media/api.go?action=barMember"+c.baseApiParams,{actionType:b.actionType||1,barId:b.barId,custId:b.custId||""},function(a){if(0!=a.status.code&&10003!=a.status.code&&25015!=a.status.code)return void c.setMessageTip("好像发生了什么事情，稍后再试试吧~");b.callback(a)})},c.onTime=function(b){var c=a(window).scrollTop(),d=a(document).height();return c+a(window).height()+b>=d},c.dealStar=function(a){return Math.round(a)},c.login=function(){location.href="https://login.dangdang.com/signin.aspx?returnurl="+encodeURIComponent(location.href)},c.setMessageTip=function(b){var c=this;c.msgTip=a(".message-tip"),0==c.msgTip.length&&(c.msgTip=a('<div class="message-tip"></div>'),a("body").append(c.msgTip)),clearTimeout(c.msgTipTime),c.msgTip.html(b).fadeIn(1e3),c.msgTipTime=setTimeout(function(){c.msgTip.fadeOut(1e3)},2500)},c.hideMessageTip=function(){var b=this;b.msgTip=a(".message-tip"),clearTimeout(b.msgTipTime),b.msgTip.hide()},c.getHost=function(){return"http://e.dangdang.com/"},window.productPostsNum=function(){window.productDetailReturn&&window.productBarReturn&&a("#postNum").length>0&&""==a("#postNum").html()&&a("#postNum").html("("+window.productComNum+"人评论)")},window.productComNum=0,window.productDetailReturn=!1,window.productBarReturn=!1,window.nofind=function(a,b){a.src=b||"img/book_def_180_260.png",a.onerror=null},document.ondragstart=function(){return!1},c}),define("dealPrice",[],function(){return{init:function(a){var b="";if(null!=a&&a.mediaList&&a.mediaList[0]){var c=a.mediaList[0];if(3==c.promotionId||1==c.freeBook)b="免费";else if(2==c.mediaType){void 0==c.price?b="":0==c.price?b="免费":c.promotionPrice&&void 0!=c.promotionPrice?(b=Math.min((parseInt(c.price)/100).toFixed(2),c.promotionPrice),b="￥"+b.toFixed(2)):b="￥"+(parseInt(c.price)/100).toFixed(2)}else 1==c.mediaType?b=1==a.isSupportFullBuy?void 0==a.price?"":0==a.price?"免费":parseInt(a.price)+"铃铛/本":void 0==c.priceUnit?"":0==c.priceUnit?"免费":parseInt(c.priceUnit)+"铃铛/千字":4==c.mediaType?b=1==a.isSupportFullBuy?void 0==a.price?"":0==a.price?"免费":parseInt(a.price)+"铃铛/本":void 0==c.priceUnit?"":0==c.priceUnit?"免费":parseInt(c.priceUnit)+"铃铛/话":3==c.mediaType&&(b=0==c.lowestPrice?"免费":"￥"+(parseInt(100*c.lowestPrice)/100).toFixed(2));return b}},dealPrice2:function(a){var b="";if(null!=a)if(3==a.promotionId)b="免费";else if(2==a.mediaType){b=void 0==a.price?"":0==a.price?"免费":"￥"+(parseInt(a.price)/100).toFixed(2)}else 1==a.mediaType?b=1==a.isSupportFullBuy?void 0==a.price?"":0==a.price?"免费":parseInt(a.price)+"铃铛/本":void 0==a.priceUnit?"":0==a.priceUnit?"免费":parseInt(a.priceUnit)+"铃铛/千字":4==a.mediaType?b=1==a.isSupportFullBuy?void 0==a.price?"":0==a.price?"免费":parseInt(a.price)+"铃铛/本":void 0==a.priceUnit?"":0==a.priceUnit?"免费":parseInt(a.priceUnit)+"铃铛/话":3==a.mediaType&&(b=0==a.lowestPrice?"免费":"￥"+(parseInt(100*a.lowestPrice)/100).toFixed(2));return b},originPrice:function(a){var b="";return void 0!=a.paperBookId&&""!=a.paperBookId&&(b="￥"+(parseInt(a.paperBookPrice)/100).toFixed(2)),b}}}),define("productBooklistModule",["jquery","underscore","backbone","ddbase","dealPrice"],function(a,b,c,d,e){var f={};return f.module=c.Model.extend({defaults:{mediaList:[{authorPenname:"",coverPic:"",mediaId:"",mediaType:"",saleId:"",subTitle:"",title:""}]}}),f.collection=c.Collection.extend({model:f.module}),f.view=c.View.extend({initialize:function(a){var b=this;b.el=a.el,b.dataUrl=a.dataUrl+d.baseApiParams+"&mediaId="+a.id,b.template=a.template,b.collection=new f.collection,b.dataKey=a.dataKey||"mediaList",b.render()},render:function(){var c=this;c.collection.fetch({url:c.dataUrl,success:function(f,g){0==g.status.code&&(c.collection.set(g.data[c.dataKey]),a(c.el).html(b.template(c.template)({data:c.collection,dealPrice:e,ddbase:d})))},error:function(){}})}}),f}),define("loginModule",["jquery","ddbase"],function(a,b){return function(a){if(""==b.token()){var c,d="https://login.dangdang.com/signin.aspx";c=void 0!=a&&""!=a?a:window.location.href.toString(),window.location.href=d+"?returnurl="+encodeURIComponent(c)}}}),define("collect_",["jquery","underscore","ddbase","loginModule"],function(a,b,c,d){var e={},f=function(){h()},g=function(){a.get("/media/api.go?action=getUpdateCustomerSubscribe"+c.baseApiParams,{appId:1,deviceSerialNo:"html5",mediaId:e.collectId,operationType:1},function(a){})},h=function(){a(e.el).delegate(".collection","click",function(){if(!c.token())return void d();var b=a(this),f="/media/api2.go?action=dDReaderStoreUpSave&type=media";"1"==e.isStore&&(f="/media/api2.go?action=dDReaderStoreUpCancel&type=media"),f=f+"&targetIds="+e.collectId+c.baseApiParams,a.get(f,function(a){0!=a.status.code?c.setMessageTip(a.status.message):"1"===e.isStore?(e.isStore="0",b.find(".text").text("收藏")):(e.isStore="1",b.find(".text").text("取消收藏"),e.mediaType&&1==e.mediaType&&g())})})};return{render:function(a){a.el&&a.collectId&&(a.isStore=a.isStore||"0",e=a,f())}}}),define("productBarTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<div class="inner clearfix"><div class="pic"><div class="pic_wrap"><img src="<%=data.get("barImgUrl")%>" alt=""></div></div><div class="desc"><% var link = "bar_detail_page.html?barId="+data.get("barId")%><h1 class="title"><a href="<%=link%>"><%=data.get("barName")%></a></h1></div><div class="fans clearfix"><a class="bar_write_btn" href="javascript:;" memberStatus=<%=data.get("memberStatus")%> barId=<%=data.get("barId")%> >加入书吧</a><span>帖子数：2167</span><span>成员数：1134</span></div><div class="masks" id="mask"></div><div class="pop_enter_wrap" id="enterBar"><div class="opacity_border"></div><div class="pop_enter"><img src="img/pop_enter_bar.jpg" alt=""><p class="pop_btn_line"><a href="javascript:;" class="no pop_btn" status="0">取消</a><a href="javascript:;" class="yes pop_btn" status="1" barId=<%=data.get("barId")%>>加入</a></p></div></div></div><div class="showAll"><a class="read_more_post" href="bar_detail_page.html?barId=<%=data.get("barId")%>" target="_blank">查看全部帖子</a></div><div class="form"><div class="item"><div class="label">标题:</div><div class="content"><input type="text" placeholder="" id="postTitle"/></div></div><div class="item"><div class="label">内容:</div><div class="content" id="postContent"><iframe frameborder="0" id="ueditorIframe" name="ueditorIframe" width="100%" height="360" src="/article/uePC.go?width=743&height=260"></iframe></div></div></div><div class="comments"><a class="commentBtn">评论</a></div>'}),define("productBarpostsTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<%data.each(function(item,j){%><% var barId = item.get("barId")%><% var digestId = item.get("mediaDigestId")%><%var link="post_detail_page.html?barId="+barId+"&digestId="+digestId;%><%if(j<3){%><div class="product_barposts_module clearfix"><div class="pic"><img src="<%=item.get("userBaseInfo").custImg%>" alt=""><div class="name"><%=item.get("userBaseInfo").nickName%></div></div><div class="desc"><div class="post_con"><h1 class="title"><a href="<%=link%>" target="_blank"><%=item.get("title")%></a><div class="time"><%=ddbase.dealTime(item.get("createDateLong"))%></div></h1><div class="content"><div class="brief"> <a href="<%=link%>" class="left" target="_blank"><%=item.get("content")%></a></div></div><%if(item.imgList&&item.get(imgList).length>0){%><ul class="pic_list clearfix"><%_.each(data.imgList,function(imgdata,i){%><%if(i<3){%><li><a href="<%=link%>" target="_blank"><img src="<%=imgdata%>" alt=""></a></li><%}%><%})%></ul><%}%></div><div class="community clearfix"><a href="javascript:;" class="favor" data-praise="false" digestId=<%=item.get("mediaDigestId")%>><i class="icon icon_size_20"></i><em class="praise_num">点赞</em></a><a href="<%=link%> target="_blank" class="comment"><i class="icon icon_size_20"></i><em>回复</em></a></div></div></div><%}%><%if(length>3&&j==2){%><div class="product_barmore_module"><a href="bar_detail_page.html?barId=<%=barId%>" target="_blank">去看更多帖子(123条) > </a></div><%}%><%})%>'}),define("praise",["jquery","ddbase","loginModule"],function(a,b,c){var d={init:function(a){var d=this;d.getData(a);var e=b.token();""==e?c():d.prasieStart(e)},getData:function(a){var b=this;b.data={url:a.url,targetId:a.targetId,targetSource:a.targetSource,el:a.el},b.data.callback=a.callback||function(){}},prasieStart:function(a){var c=this;"true"==c.data.el.attr("data-praise")?b.setMessageTip("已经赞过了哦，亲。"):c.ajaxFn("GET",c.data.url,{targetId:c.data.targetId,token:a,targetSource:c.data.targetSource},c.praiseSuc,c.praiseFail,c.data.callback)},ajaxFn:function(c,d,e,f,g,h){a.ajax({type:c,url:d+b.setBaseApiParams(),data:e,timeout:1e4,success:function(a){f(a),0===a.status.code&&h()},error:function(){g()}})},praiseSuc:function(a){var c=d,e=a.status.code;if(0===e){b.setMessageTip("点赞成功"),c.data.el.attr("data-praise","true"),c.data.el.addClass("praise_suc");var f=c.data.el.find(".praise_num");f.length>0&&f.text(parseInt(f.text())+1)}else 40010===e?b.setMessageTip("已经赞过了哦，亲。"):b.setMessageTip("点赞失败!")},praiseFail:function(){b.setMessageTip("网络出错!")}};return d}),define("enterBar",["jquery","ddbase","loginModule"],function(a,b,c){var d={init:function(a){var d=this,e=b.token();d.data={url:a.url,actionType:a.actionType,barId:a.barId,btn:a.btn,callBack:a.callBack||function(){}},""==e&&c(),d.enterStart(e)},enterStart:function(a){var b=this;b.ajaxFn("GET",b.data.url,{barId:b.data.barId,token:a,actionType:b.data.actionType},b.enterSuc,b.enterFail)},ajaxFn:function(c,d,e,f,g){a.ajax({type:c,url:d+b.setBaseApiParams(),data:e,timeout:1e4,success:function(a){f(a)},error:function(){g()}})},enterSuc:function(c){var e=d,f=c.status.code;0===f?(a("#mask").hide(),a("#enterBar").hide(),b.setMessageTip("加入成功"),a(e.data.btn).attr("memberStatus",1).text("已加入")):(f=25015)?b.setMessageTip("已经是吧成员!"):b.setMessageTip("加入失败!"),a("#mask").hide(),a("#enterBar").hide()},enterFail:function(){b.setMessageTip("网络出错!")}};return d}),define("post",["jquery","underscore","ddbase","loginModule"],function(a,b,c,d){document.domain="dangdang.com";var e={},f=function(){var b=document.getElementById("ueditorIframe").contentWindow.document.getElementById("ueditor_0").contentWindow.document.body;return a(b).html()},g=function(b){var c=document.getElementById("ueditorIframe").contentWindow.document.getElementById("ueditor_0").contentWindow.document.body,d=a(c).text().length,e=a(c).find("img").length;return d&&e?1:d>0&&0==e?0:0==d&&e>0?2:void 0},h=function(){var b=a("#postTitle").val(),d=f(),h=b.replace(/\s+/g,""),i=d.replace(/<br>|<p>|<\/p>|\s+|(&nbsp;)+/g,"");return h&&i?{barId:e.barId,mediaDigestId:"",title:b,content:d,cardType:g(d),actionType:"1"}:(c.setMessageTip("请填写完整"),!1)},i=function(){a(".shadow.post").show(),a(".window.post").show()},j=function(){a(".shadow.post").hide(),a(".window.post").hide()},k=function(){a("body").delegate(".window.post .submitbtn","click",function(){var b=h();b&&a.ajax({url:"/media/api.go?action=publishRtfArticle"+c.baseApiParams,type:"post",data:b,success:function(a){return 10003==a.status.code?void d():0!=a.status.code?void c.setMessageTip(a.status.message+",发帖失败，请修改后重试！"):(e.callback&&e.callback(),void j())}})}),a("body").delegate(".window.post .close","click",function(){j()}),a("body").delegate(".shadow.post","click",function(){j()})};return{show:function(b){if(!c.token())return void d();if(b.barId)if(e=b,1===a(".window.post").length)i();else{var f=c.template(a("#postModuleTemplate").html());a("body").append(f),k()}}}}),define("productBar",["jquery","underscore","backbone","ddbase","praise","enterBar","loginModule","post"],function(a,b,c,d,e,f,g,h){var i={};return i.module=c.Model.extend({defaults:{}}),i.module2=c.Model.extend({defaults:{articleNum:"",barDesc:"",barId:"",barImgUrl:"",barName:"",barStatus:"",barType:"",createDate:"",isActivity:"",lastModifiedDate:"",memberNum:"",memberStatus:""}}),i.collection=c.Collection.extend({model:i.module}),i.view=c.View.extend({events:{},barId:"",initialize:function(a){var b=this;b.el=a.el,b.barEl=a.barEl,b.postsEl=a.postsEl,b.dataUrl=a.dataUrl+d.baseApiParams+"&objectId="+d.getQueryString("mediaId"),b.barTemplate=a.barTemplate,b.postsTemplate=a.postsTemplate,b.barModule=new i.module2,b.postsCollections=new i.collection,b.render()},render:function(){var c=this;c.barModule.fetch({url:c.dataUrl,success:function(e,f){0==f.status.code&&(f.data.barInfo?(c.barModule.set(f.data.barInfo),c.postsCollections.set(f.data.articleList),a(c.barEl).html(b.template(c.barTemplate)({data:c.barModule})),a(c.postsEl).html(b.template(c.postsTemplate)({data:c.postsCollections,length:f.data.barInfo.articleNum,ddbase:d})),window.productComNum=f.data.barInfo.articleNum):(window.productComNum=0,a(c.barEl).addClass("no_bar"),a(c.barEl).html(b.template('<p class="tips">这里没找到对应吧，可以在当当云阅读客户端中创建哦！</p>'))),window.productBarReturn=!0,window.productPostsNum())},error:function(){}})},favor:function(b){var c=a(b.target).parent(),d=c.attr("digestId");e.init({url:"/media/api2.go?action=praiseComment&commentType=1&isAnonymous=1",targetId:d,targetSource:1e3,el:c})},writePosts:function(b){var c=this,e=a(b.target);barId=e.attr("barId");var f=e.attr("memberStatus");""==d.token()?g():4==f?(a("#mask").show(),a("#enterBar").show()):c.popWritePost(barId)},enterBarFn:function(b){var c=this,d=a(b.target);0==d.attr("status")?(a("#mask").hide(),a("#enterBar").hide()):(barId=d.attr("barId"),f.init({url:"/media/api.go?action=barMember",actionType:1,barId:barId,callBack:c.popWritePost,btn:"#bar .bar_write_btn"}))},popWritePost:function(a){h.show({barId:a,callback:function(){d.setMessageTip("发布成功！")}})}}),i}),define("qrcode",["jquery"],function(a){return function(b){b.fn.qrcode=function(c){function d(a){this.mode=i,this.data=a}function e(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function f(a,b){if(void 0==a.length)throw Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function g(a,b){this.totalCount=a,this.dataCount=b}function h(){this.buffer=[],this.length=0}var i;d.prototype={getLength:function(){return this.data.length},write:function(a){for(var b=0;b<this.data.length;b++)a.put(this.data.charCodeAt(b),8)}},e.prototype={addData:function(a){this.dataList.push(new d(a)),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var b=g.getRSBlocks(a,this.errorCorrectLevel),c=new h,d=0,e=0;e<b.length;e++)d+=b[e].dataCount;for(e=0;e<this.dataList.length;e++)b=this.dataList[e],c.put(b.mode,4),c.put(b.getLength(),j.getLengthInBits(b.mode,a)),b.write(c);if(c.getLengthInBits()<=8*d)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,b){this.moduleCount=4*this.typeNumber+17,this.modules=Array(this.moduleCount);for(var c=0;c<this.moduleCount;c++){this.modules[c]=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[c][d]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,b),7<=this.typeNumber&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,b)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=j.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){for(a=a.createEmptyMovieClip(b,c),this.make(),b=0;b<this.modules.length;b++)for(var c=1*b,d=0;d<this.modules[b].length;d++){var e=1*d;this.modules[b][d]&&(a.beginFill(0,100),a.moveTo(e,c),a.lineTo(e+1,c),a.lineTo(e+1,c+1),a.lineTo(e,c+1),a.endFill())}return a},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var f=-2;2>=f;f++)for(var g=-2;2>=g;g++)this.modules[d+f][e+g]=-2==f||2==f||-2==g||2==g||0==f&&0==g}},setupTypeNumber:function(a){for(var b=j.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(b>>c&1);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(c=0;18>c;c++)d=!a&&1==(b>>c&1),this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d},setupTypeInfo:function(a,b){for(var c=j.getBCHTypeInfo(this.errorCorrectLevel<<3|b),d=0;15>d;d++){var e=!a&&1==(c>>d&1);6>d?this.modules[d][8]=e:8>d?this.modules[d+1][8]=e:this.modules[this.moduleCount-15+d][8]=e}for(d=0;15>d;d++)e=!a&&1==(c>>d&1),8>d?this.modules[8][this.moduleCount-d-1]=e:9>d?this.modules[8][15-d-1+1]=e:this.modules[8][15-d-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,f=0,g=this.moduleCount-1;0<g;g-=2)for(6==g&&g--;;){for(var h=0;2>h;h++)if(null==this.modules[d][g-h]){var i=!1;f<a.length&&(i=1==(a[f]>>>e&1)),j.getMask(b,d,g-h)&&(i=!i),this.modules[d][g-h]=i,e--,-1==e&&(f++,e=7)}if(0>(d+=c)||this.moduleCount<=d){d-=c,c=-c;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(a,b,c){for(var b=g.getRSBlocks(a,b),d=new h,f=0;f<c.length;f++){var i=c[f];d.put(i.mode,4),d.put(i.getLength(),j.getLengthInBits(i.mode,a)),i.write(d)}for(f=a=0;f<b.length;f++)a+=b[f].dataCount;if(d.getLengthInBits()>8*a)throw Error("code length overflow. ("+d.getLengthInBits()+">"+8*a+")");for(d.getLengthInBits()+4<=8*a&&d.put(0,4);0!=d.getLengthInBits()%8;)d.putBit(!1);for(;!(d.getLengthInBits()>=8*a)&&(d.put(e.PAD0,8),!(d.getLengthInBits()>=8*a));)d.put(e.PAD1,8);return e.createBytes(d,b)},e.createBytes=function(a,b){for(var c=0,d=0,e=0,g=Array(b.length),h=Array(b.length),i=0;i<b.length;i++){var k=b[i].dataCount,l=b[i].totalCount-k,d=Math.max(d,k),e=Math.max(e,l);g[i]=Array(k);for(var m=0;m<g[i].length;m++)g[i][m]=255&a.buffer[m+c];for(c+=k,m=j.getErrorCorrectPolynomial(l),k=new f(g[i],m.getLength()-1).mod(m),h[i]=Array(m.getLength()-1),m=0;m<h[i].length;m++)l=m+k.getLength()-h[i].length,h[i][m]=0<=l?k.get(l):0}for(m=i=0;m<b.length;m++)i+=b[m].totalCount;for(c=Array(i),m=k=0;m<d;m++)for(i=0;i<b.length;i++)m<g[i].length&&(c[k++]=g[i][m]);for(m=0;m<e;m++)for(i=0;i<b.length;i++)m<h[i].length&&(c[k++]=h[i][m]);return c},i=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;0<=j.getBCHDigit(b)-j.getBCHDigit(j.G15);)b^=j.G15<<j.getBCHDigit(b)-j.getBCHDigit(j.G15);return(a<<10|b)^j.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;0<=j.getBCHDigit(b)-j.getBCHDigit(j.G18);)b^=j.G18<<j.getBCHDigit(b)-j.getBCHDigit(j.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case 0:return 0==(b+c)%2;case 1:return 0==b%2;case 2:return 0==c%3;case 3:return 0==(b+c)%3;case 4:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case 5:return 0==b*c%2+b*c%3;case 6:return 0==(b*c%2+b*c%3)%2;case 7:return 0==(b*c%3+(b+c)%2)%2;default:throw Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new f([1],0),c=0;c<a;c++)b=b.multiply(new f([1,k.gexp(c)],0));return b},getLengthInBits:function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case i:case 8:return 8;default:throw Error("mode:"+a)}else if(27>b)switch(a){case 1:return 12;case 2:return 11;case i:return 16;case 8:return 10;default:throw Error("mode:"+a)}else{if(!(41>b))throw Error("type:"+b);switch(a){case 1:return 14;case 2:return 13;case i:return 16;case 8:return 12;default:throw Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d++)for(var e=0;e<b;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||b<=d+h))for(var i=-1;1>=i;i++)0>e+i||b<=e+i||0==h&&0==i||g==a.isDark(d+h,e+i)&&f++;5<f&&(c+=3+f-5)}for(d=0;d<b-1;d++)for(e=0;e<b-1;e++)f=0,a.isDark(d,e)&&f++,a.isDark(d+1,e)&&f++,a.isDark(d,e+1)&&f++,a.isDark(d+1,e+1)&&f++,(0==f||4==f)&&(c+=3);for(d=0;d<b;d++)for(e=0;e<b-6;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e++)for(d=0;d<b-6;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e++)for(d=0;d<b;d++)a.isDark(d,e)&&f++;return a=Math.abs(100*f/b/b-50)/5,c+10*a}},k={glog:function(a){if(1>a)throw Error("glog("+a+")");return k.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return k.EXP_TABLE[a]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},l=0;8>l;l++)k.EXP_TABLE[l]=1<<l;for(l=8;256>l;l++)k.EXP_TABLE[l]=k.EXP_TABLE[l-4]^k.EXP_TABLE[l-5]^k.EXP_TABLE[l-6]^k.EXP_TABLE[l-8];for(l=0;255>l;l++)k.LOG_TABLE[k.EXP_TABLE[l]]=l;return f.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=k.gexp(k.glog(this.get(c))+k.glog(a.get(d)));return new f(b,0)},mod:function(a){if(0>this.getLength()-a.getLength())return this;for(var b=k.glog(this.get(0))-k.glog(a.get(0)),c=Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(d=0;d<a.getLength();d++)c[d]^=k.gexp(k.glog(a.get(d))+b);return new f(c,0).mod(a)}},g.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],g.getRSBlocks=function(a,b){var c=g.getRsBlockTable(a,b);if(void 0==c)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;f<d;f++)for(var h=c[3*f+0],i=c[3*f+1],j=c[3*f+2],k=0;k<h;k++)e.push(new g(i,j));return e},g.getRsBlockTable=function(a,b){switch(b){case 1:return g.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return g.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return g.RS_BLOCK_TABLE[4*(a-1)+2];case 2:return g.RS_BLOCK_TABLE[4*(a-1)+3]}},h.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,b){for(var c=0;c<b;c++)this.putBit(1==(a>>>b-c-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}},"string"==typeof c&&(c={text:c}),c=b.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"},c),this.each(function(){var d;if("canvas"==c.render){d=new e(c.typeNumber,c.correctLevel),d.addData(c.text),d.make();var f=document.createElement("canvas");f.width=c.width,f.height=c.height;for(var g=f.getContext("2d"),h=c.width/d.getModuleCount(),i=c.height/d.getModuleCount(),j=0;j<d.getModuleCount();j++)for(var k=0;k<d.getModuleCount();k++){g.fillStyle=d.isDark(j,k)?c.foreground:c.background;var l=Math.ceil((k+1)*h)-Math.floor(k*h),m=Math.ceil((j+1)*h)-Math.floor(j*h);g.fillRect(Math.round(k*h),Math.round(j*i),l,m)}}else for(d=new e(c.typeNumber,c.correctLevel),d.addData(c.text),d.make(),f=b("<table></table>").css("width",c.width+"px").css("height",c.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",c.background),g=c.width/d.getModuleCount(),h=c.height/d.getModuleCount(),i=0;i<d.getModuleCount();i++)for(j=b("<tr></tr>").css("height",h+"px").appendTo(f),k=0;k<d.getModuleCount();k++)b("<td></td>").css("width",g+"px").css("background-color",d.isDark(i,k)?c.foreground:c.background).appendTo(j);d=f,a(d).appendTo(this)})}}(a),a}),define("share_",["qrcode","underscore"],function(a,b){var c=function(a){for(key in a)e.module[key]=a[key]},d=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]||""));return b.join("&")},e={module:{title:"PC书城",desc:"",pic:"http://img62.ddimg.cn/digital/product/42/84/1960064284_ii_cover.jpg?version=9b5b3b6a-6357-4c70-bf01-1f4d37709e26",url:document.location.href},openurl:{sina:"http://service.weibo.com/share/share.php?",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",qq:"http://connect.qq.com/widget/shareqq/index.html?",qqweibo:"http://share.v.t.qq.com/index.php?c=share&a=index&"}},f=function(){a(e.module.el).delegate(".shareC","mouseover",function(){a(this).addClass("focus"),a(this).find(".sharelist").show()}),a(e.module.el).delegate(".shareC","mouseout",function(){a(this).removeClass("focus"),a(this).find(".sharelist").hide(),a(this).find(".weixinC").hide()}),a(e.module.el).delegate(".icon.clicked","click",function(){var b=a(this).attr("data-type");window.open(e.openurl[b]+d(e.params[b]))}),a(e.module.el).delegate(".icon.weixin","mouseover",function(){var b=a(this).attr("data-type");if(0===a(this).find("table,canvas").length){var b=document.createElement("canvas").getContext?"canvas":"table";a(this).find(".weixinC").qrcode({render:b,width:100,height:110,correctLevel:0,text:e.module.url})}a(this).find(".weixinC").show()}),a(e.module.el).delegate(".icon.weixin","mouseout",function(){a(this).find(".weixinC").hide()})},g=function(a){c(a),e.params={sina:{url:e.module.url,title:e.module.title+"（摘要："+e.module.desc.substr(0,80)+"...）",pic:e.module.pic,language:"zh_cn",searchPic:!1,appkey:1315955721,ralateUid:1647263235},qzone:{url:e.module.url,title:e.module.title,pics:e.module.pic,summary:e.module.desc.substr(0,200)},qq:{url:e.module.url,title:e.module.title,pics:e.module.pic,summary:e.module.desc.substr(0,200)}},f()};return{render:function(a){a.el&&g(a)}}}),define("publicHeaderNav",["jquery"],function(a){return{itHover:function(){var b=a(".public_headernav_module .nav li");b.bind("mouseenter",function(){clearTimeout(c),a(this).hasClass("chubannav")||a(this).hasClass("yuanchuangnav")?(a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(this).hasClass("chubannav")?(a(".chuban").css({display:"block"}),a(".public_child_nav").css({display:"block"})):a(this).hasClass("yuanchuangnav")&&(a(".yuanchuang").css({display:"block"}),a(".public_child_nav").css({display:"block"}))):(a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"}))});var c=null;b.bind("mouseleave",function(){c=setTimeout(function(){a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"})},1e3)});var d=a(".public_headerchildnav_module");d.bind("mouseenter",function(){clearTimeout(c)}),d.bind("mouseleave",function(){a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"})})}}}),define("publicHeaderChildnavModule",["jquery"],function(a){return{itHover:function(){a(".yuanchuang .inner a").bind("mouseenter",function(){a(".yuanchuang .inner a i").removeClass("on"),a(this).find("i").addClass("on")})}}}),define("publicSideCodeModule",["jquery"],function(a){return{toTop:function(){a(".public_totop_module, .back_to_top").on("click",function(){a(window).scrollTop(0)}),a(window).bind("scroll",function(){0===a(window).scrollTop()?a(".public_totop_module").hide():a(".public_totop_module").show()})},closeCode:function(){a(".public_sideecode_module .close").on("click",function(){a(".public_sideecode_module").css({display:"none"})})}}}),define("signOutModule",["jquery","ddbase"],function(a,b){return function(c){if(""!=b.token()){var d="/media/api2.go?action=loginOutV2"+b.setBaseApiParams();a.ajax({method:"POST",url:d,success:function(a){0==parseInt(a.status.code)&&(b.delCookie("sessionID"),b.delCookie("MDD_username"),b.delCookie("MDD_custId"),b.delCookie("login.dangdang.com"),void 0!=c&&c())}})}}}),define("headerChildNav",["jquery","ddbase"],function(a,b){return{init:function(a){var c=this;"original_index"==c.judgePage()&&("man"==b.getQueryString("originalSex")||null==b.getQueryString("originalSex")?c.initPage(a,0):"woman"==b.getQueryString("originalSex")&&c.initPage(a,1)),c.change(a)},change:function(b){a("#originLeftMenuMan").click(function(){window.location.href="original_index_page.html?originalSex=man"}),a("#originLeftMenuWoman").click(function(){window.location.href="original_index_page.html?originalSex=woman"})},clickfn:function(a,b){this.initPage(a,b)},judgePage:function(){var a=window.location.pathname,b=a.lastIndexOf("/");return a=a.substr(b+1,a.length-b),a=a.split("_page")[0]},initPage:function(b,c){for(key in b)"#focusPic"!=b[key]?(a(b[key]).find(".sexContent").hide().eq(c).show(),a(b[key]).find(".more li").hide().eq(c).show(),a(b[key]).find(".nav li").hide().eq(c).show(),a(window).scroll()):(a(b[key]).find(".sexContent").css({opacity:0,"z-index":1}).eq(c).css({opacity:1,"z-index":10}),0==c&&window.originWomanPic&&window.originManPic?(originWomanPic.timer=setTimeout(function(){window.originWomanPic.stop()},0),window.originManPic.stop(),window.originManPic.play()):1==c&&window.originWomanPic&&window.originManPic&&(originManPic.timer=setTimeout(function(){window.originManPic.stop()},0),window.originWomanPic.stop(),window.originWomanPic.play()))}}}),define("publicMethodNew",["jquery","publicHeaderNav","publicHeaderChildnavModule","publicSideCodeModule","loginModule","signOutModule","ddbase","headerChildNav"],function(a,b,c,d,e,f,g,h){var i={init:function(){b.itHover(),d.toTop(),d.closeCode(),c.itHover(),this.checkReadingCenterLogin(),this.jumpToRecharge(),this.jumpToMyShelf(),this.headerNavHover(),h.init({el1:"#originHotArticle",el2:"#originRecommend",el3:"#originLimitedFree",el4:"#originRightRecomend",el5:"#originBigAds",el6:"#hotWholeBook",el7:"#originalHotTopic",el8:"#focusPic",el9:"#rewardsListBySe",el10:"#rewardsListBySex"}),i.setHeaderImg(),a("#loginBtn").click(function(){e()}),a("#signOutBtn").on("click",function(){f(i.setLoginHtml())}),a("#headerMyOrder").on("click",function(){if(""==g.token()){var a=window.location.href;a=a.split("/"),a[a.length-1]="http://orderb.dangdang.com/myallorders.aspx",a=a.join("/"),e(a)}else window.location="http://orderb.dangdang.com/myallorders.aspx"});var j=g.getQueryString("channelId");null==j&&(j=7e4),g.setCookie("MDD_channelId",j,8760),g.setCookie("MDD_fromPlatform","307",8760),this.readcenterRedpoint()},setHeaderImg:function(){if(""!=g.token()){var b=g.getUserName(),c='<img class="header_img" src="img/payment/head_img.png">'+b;a("#loginBtn").html(c),a("#loginBtn").after('<span id="signOutBtn">[退出]</span>'),a("#registerBtn").html("")}},headerNavHover:function(){a("#bookClass,#bookClassBox").mouseout(function(){a("#bookClass .upDown").removeClass("isSlide"),a("#bookClassBox").removeClass("showMenu")}),a("#bookClass,#bookClassBox").mouseover(function(){a("#bookClass .upDown").addClass("isSlide"),a("#bookClassBox").addClass("showMenu")})},setLoginHtml:function(){a("#signOutBtn").remove(),a("#loginBtn").html("你好，请登录"),a("#registerBtn").html('<a target="_blank" href="https://login.dangdang.com/Register.aspx?returnurl=http://e.dangdang.com/">免费注册</a>|')},setProductTotalCount:function(b){parseInt(b)>0&&a(".public_headersearch_module .shopcar_num").html("("+b+")"),0==parseInt(b)&&a(".public_headersearch_module .shopcar_num").html("")},checkReadingCenterLogin:function(){a("#readingCenterBtn").on("click",function(a){if(a.preventDefault(),g.token()&&""!=g.token())window.location.href="http://e.dangdang.com/reading_center_page.html";else{var b=window.location.href;e(b)}})},jumpToRecharge:function(){a(".public_headernav_module .want_to_recharge").on("click",function(a){a.preventDefault(),g.token()&&""!=g.token()?window.location.href="http://e.dangdang.com/recharge_methord_page.html?fromPlatform=309":e()})},readcenterRedpoint:function(){var b=this;g.token()&&a.get("/media/api.go?action=getCustomerSubscription"+g.baseApiParams,{start:0,end:10},function(a){0==a.status.code&&0!=a.data.allUpdateChapter&&0!=a.data.allUpdateMedia&&(g.getCookie("showzhuigengredpointer")||b.zhuigengNotice(a.data))})},jumpToMyShelf:function(){a("#toMyBookShelf").on("click",function(a){a.preventDefault();var b="http://e.dangdang.com/booksshelf_page.html";g.token()&&""!=g.token()?window.location.href=b:e(b)})},getMedia:function(a){for(var b={},c=0;c<a.mediaList.length;c++)if(a.mediaList[c].subscriptionCount>0){b=a.mediaList[c];break}return 1==a.allUpdateMedia?'<span class="title">'+b.title+'</span>已经更新至<span class="lastChapt">'+b.lastUpdateChapter+"</span>":'<span class="title">'+b.title+"</span>等已经有了更新"},zhuigengNotice:function(b){var c=window.location.href;if(-1!=c.indexOf("index_page")||-1!=c.indexOf("publish_index_page")||-1!=c.indexOf("original_index_page.html")){var d='<div class="zhuigengNotice"><div class="title">更新通知<div class="closeBtn"></div></div><div class="content"><div>'+this.getMedia(b)+'</div><a class="gotoRead" href="booksshelf_page.html?tab=read">去书架</a></div></div>';a("body").append(d),a("body").delegate(".zhuigengNotice .closeBtn","click",function(){a(".zhuigengNotice").hide()})}}};return i}),define("originalAlsoBuyTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<%if(data.length>0){%><div class="product_rectitle_module">买了此书的人还买过</div><%data.each(function(item){%><div class="product_reccell_module clearfix"><%var link = ddbase.getBookUrl({saleId:item.get("saleId"),mediaId:item.get("mediaId"),mediaType:item.get("mediaType"),productId:item.get("saleId")})%><div class="bookcover"><a href="<%=link%>" target="_blank"><img onerror = "this.src=\'img/book_def_74_105.png\'" src="<%=item.get("coverPic").replace("_aa_cover","_cc_cover")%>" /></a></div><div class="bookinfo"><div class="title"><a href="<%=link%>" target="_blank" title="<%=item.get("title")%>"><%=item.get("title")%></a></div><div class="author"><%=item.get("authorPenname")%></div><div class="price"><%var price = dealPrice.dealPrice2(item.toJSON())%><span class="now"><%=price%></span><%var originPrice = dealPrice.originPrice(item.toJSON())%><%if(originPrice !=""){%>|<span class="ori"><%=originPrice%></span><%}%></div></div></div><%})%><%}%>'}),define("recommendTopTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<%if(data.length>0){%><div class="product_rectitle_module">强力推荐</div><div class="recommend_cell_wrap clearfix"><%data.each(function(item){%><%var item_detail = item.get("mediaList")[0];%><div class="product_reccell_module clearfix"><%var link = ddbase.getBookUrl({saleId:item_detail.saleId,mediaId:item_detail.mediaId,mediaType:item_detail.mediaType,productId:item_detail.productId})%><div class="bookcover"><a href="<%=link%>" target="_blank"><img onerror = "javascript:nofind(this,\'img/book_def_74_105.png\');" src="<%=item_detail.coverPic.replace("_aa_cover","_cc_cover")%>" /></a></div><div class="bookinfo"><div class="title"><a href="<%=link%>" target="_blank"  title="<%=item_detail.title%>"><%=item_detail.title %></a></div><div class="author"><%=item_detail.authorPenname %></div><div class="price"><%var price = dealPrice.init(item.toJSON())%><span class="now"><%=price%></span><%var originPrice = dealPrice.originPrice(item.toJSON().mediaList[0])%><%if(originPrice!=""){%>|<span class="ori"><%=originPrice%></span><%}%></div></div></div><%})%></div><%}%>'}),define("quickPayMethordModuleTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<%var account = data.getAccount.data.account;%><%var accountMoney = parseInt(account.attachAccountMoney)+parseInt(account.masterAccountMoney);%><%var payable = 0;%><%if(data.getEbookOrderFlowV3){%><%payable = parseFloat(data.getEbookOrderFlowV3.data.payable);%><%}else{%><%payable = price;%><%}%><div class="title"><em>需要支付<i><span class="payable_num"><%=payable%></span>铃铛</i></em></div><h4 class="module_title">请选择支付方式</h4><div class="payment_list"><ul><li><div class="sum_line"><span class="left"><input type="radio" name="payment" checked="checked" data-role="account"><i class="icon bell_icon"></i><label for="payment">铃铛</label></span><span class="right">余额：<em class="account_money" data-sum="<%=accountMoney%>"><%=accountMoney%></em>铃铛</span></div></li><%if(data.getEbookOrderFlowV3){%><%var ddMoney = data.getDdMoneyList.data;%><%if(ddMoney.moneyList && parseFloat(ddMoney.remainingSumRMB).toFixed(2)*100 >= payable){%><li><div class="sum_line"><span class="left"><input type="radio" name="payment" data-role="ddMoney"><i class="icon card_icon"></i><label for="payment">礼品卡</label></span><span class="right">余额：￥<em class="account_money" data-sum="<%=parseFloat(ddMoney.remainingSumRMB)*100%>"><%=parseFloat(ddMoney.remainingSumRMB).toFixed(2)%></em></span></div></li><%}%><%var validCoupon = data.getValidCoupon.data.result;%><%if(validCoupon && validCoupon.length > 0){%><%var couponMoney = 0;%><%for(var i = 0,ii = validCoupon.length;i<ii;i++){%><%var coupon = validCoupon[i];%><%if(parseFloat(coupon.couponMoney)*100 >= payable){%><%couponMoney += parseFloat(coupon.couponMoney);%><%}%><%}%><%}%><%if(couponMoney > 0){%><li><div class="sum_line"><span class="left"><input type="radio" name="payment" data-role="couponMoney"><i class="icon liquan_icon"></i><label for="payment">礼券</label></span><span class="right"><span class="money">余额：￥<em class="account_money" data-sum="<%=parseFloat(couponMoney)*100%>"><%=parseFloat(couponMoney).toFixed(2)%></em></span><span class="time"><%=data.getValidCoupon.data.currentDate.split(" ")[0]%><i class="down"></i></span></span></div><div class="detail_list"><%for(var i = 0,ii = validCoupon.length;i<ii;i++){%><%var coupon = validCoupon[i];%><%if(parseFloat(coupon.couponMoney)*100 >= payable){%><p><span class="left"><input type="radio" name="validCoupon" data-role="<%=coupon.couponCode%>"><label for="payment"><%=coupon.endDate.split(" ")[0]%></label></span><span class="right">￥<em class="account_money" data-sum="<%=parseFloat(couponMoney)*100%>"><%=coupon.couponMoney%></em></span></p><%}%><%}%></div></li><%}%><%}%></ul></div><div class="button_line"><%if(accountMoney < payable){%><span class="buy_btn rechargeBtn">充值并购买</span><%}else{%><span class="buy_btn">购买</span><%}%><span class="cancle_btn">以后再买</span></div><p class="payment_comment cf"><%if(deviceTypeCodes){%><span>图书支持设备：</span><%var deviceTypes = deviceTypeCodes.split("|");%><%if(_.indexOf(deviceTypes,"ipad") != -1){%><span><i class="icon deviceType ipad_icon"></i><br/>iPad</span><%}%><%if(_.indexOf(deviceTypes,"pconline") != -1){%><span><i class="icon deviceType pc_icon"></i><br/>PC在线</span><%}%><%if(_.indexOf(deviceTypes,"pcdownload") != -1){%><span><i class="icon deviceType pc_down_icon"></i><br/>PC下载</span><%}%><%if(_.indexOf(deviceTypes,"html5") != -1){%><span><i class="icon deviceType touch_icon"></i><br/>触屏版</span><%}%><%if(_.indexOf(deviceTypes,"android") != -1){%><span><i class="icon deviceType android_icon"></i><br/>Android</span><%}%><%if(_.indexOf(deviceTypes,"iphone") != -1){%><span><i class="icon deviceType iphone_icon"></i><br/>iPhone</span><%}%><%if(_.indexOf(deviceTypes,"eink") != -1){%><span><i class="icon deviceType doukan_icon"></i><br/>阅读器</span><%}%><%if(_.indexOf(deviceTypes,"einkd66") != -1){%><span><i class="icon deviceType dktouch_icon"></i><br/>都看阅读器触屏版</span><%}%><%}%></p>'}),define("payMethordModuleTemplate",["jquery","underscore","backbone"],function(a,b,c){return'<div class="pay_methord_module"><h4 class="module_title">请选择支付方式</h4><div class="payment_list"><%var account = data.getAccount.data.account;%><%var accountMoney = parseInt(account.attachAccountMoney)+parseInt(account.masterAccountMoney);%><%var payable = parseFloat(data.getEbookOrderFlowV3.data.payable);%><div class="payable_num" style="display:none;"><%=payable%></div><ul><li><div class="sum_line"><span class="left"><input type="radio" name="payment" checked="checked" data-role="account"><i class="icon bell_icon"></i><label for="payment">铃铛</label></span><span class="right">余额：<em class="account_money" data-sum="<%=accountMoney%>"><%=accountMoney%></em>铃铛</span></div></li><%var ddMoney = data.getDdMoneyList.data;%><%if(ddMoney.moneyList && parseFloat(ddMoney.remainingSumRMB).toFixed(2)*100 >= payable){%><li><div class="sum_line"><span class="left"><input type="radio" name="payment" data-role="ddMoney"><i class="icon card_icon"></i><label for="payment">礼品卡</label></span><span class="right">余额：￥<em class="account_money" data-sum="<%=parseFloat(ddMoney.remainingSumRMB)*100%>"><%=parseFloat(ddMoney.remainingSumRMB).toFixed(2)%></em></span></div></li><%}%><%var validCoupon = data.getValidCoupon.data.result;%><%if(validCoupon && validCoupon.length > 0){%><%var couponMoney = 0;%><%for(var i = 0,ii = validCoupon.length;i<ii;i++){%><%var coupon = validCoupon[i];%><%if(parseFloat(coupon.couponMoney)*100 >= payable){%><%couponMoney += parseFloat(coupon.couponMoney);%><%}%><%}%><%}%><%if(couponMoney > 0){%><li><div class="sum_line"><span class="left"><input type="radio" name="payment" data-role="couponMoney"><i class="icon liquan_icon"></i><label for="payment">礼券</label></span><span class="right"><span class="money">余额：￥<em class="account_money" data-sum="<%=parseFloat(couponMoney)*100%>"><%=parseFloat(couponMoney).toFixed(2)%></em></span><span class="time"><%=data.getValidCoupon.data.currentDate.split(" ")[0]%><i class="down"></i></span></span></div><div class="detail_list"><%for(var i = 0,ii = validCoupon.length;i<ii;i++){%><%var coupon = validCoupon[i];%><%if(parseFloat(coupon.couponMoney)*100 >= payable){%><p><span class="left"><input type="radio" name="validCoupon" data-role="<%=coupon.couponCode%>"><label for="payment"><%=coupon.endDate.split(" ")[0]%></label></span><span class="right">￥<em class="account_money" data-sum="<%=parseFloat(couponMoney)*100%>"><%=coupon.couponMoney%></em></span></p><%}%><%}%></div></li><%}%></ul></div><div class="button_line"><%if(accountMoney < payable){%><span class="buy_btn rechargeBtn">充值并购买</span><%}else{%><span class="buy_btn">购买</span><%}%></div></div>'}),define("purchaseEbookVirtualPaymentForPC",["jquery","underscore","ddbase"],function(a,b,c){return function(d){var e=new Date,f=d.cId||"",g=d.saleId||"",h=d.mediaType||2,i=c.getCookie("MDD_productArray")||"",j=new Array;if(d.productIds||""!=i){if(d.productIds){var j=d.productIds.toString().split(",");if(i=new Array,j.length>1)for(var k=0,l=j.length;k<l;k++){var m=j[k].split("|"),n=m[1],o=m[0],g=m[2]?m[2]:n;j.push(n),0==k?i.push('[{"productId":"'+n+'","saleId":"'+g+'","cId":"","itemId":"'+o+'"}'):k==l-1?i.push('{"productId":"'+n+'","saleId":"'+g+'","cId":"","itemId":"'+o+'"}]'):i.push('{"productId":"'+n+'","saleId":"'+g+'","cId":"","itemId":"'+o+'"}')}else{var m=j[0].split("|");if(m.length>1){var n=m[1],o=m[0],g=m[2]?m[2]:n;i.push('[{"productId":"'+n+'","saleId":"'+g+'","cId":"","itemId":"'+o+'"}]'),j.push(n)}else i.push('[{"productId":"'+j+'","saleId":"'+g+'","cId":"'+f+'"}]'),j.push(j)}}}else c.setMessageTip("参数非法，没有对应的电子书！");a.ajax({method:"POST",url:"/media/api2.go?action=purchaseEbookVirtualPaymentForPC&productArray="+i+"&dayNum="+d.dayNum+"&isAppendBorrow="+d.isAppendBorrow+"&timestamp="+e.getTime()+"&sign=html5&referType=buy&orderSource="+d.orderSource+"&fromPaltform=ds_pc"+c.setBaseApiParams().replace("fromPlatform=106","fromPlatform="+d.fromPlatform),success:function(a){var e=parseInt(a.status.code);if(0==e){var f=0;b.each(a.data.mobileMediaVoList,function(a){f+=parseFloat(a.price)}),window.location.href=c.getHost()+"cart_result_page.html?payValue="+f+"&productIds="+j.join(",")}else 27100==e?window.location.href=c.getHost()+"recharge_methord_page.html?productIds="+j.join(",")+"&mediaType="+h+"&fromPlatform=305":(d.callback&&d.callback(),27122==e?c.setMessageTip("该电子书已不支持借阅"):c.setMessageTip("消费失败！"))}})}}),define("savePayment",["jquery","underscore","ddbase"],function(a,b,c){return function(b){var d=b.cartId,e=b.orderSource,f=b.isPaperBook,g=b.fromPlatform,h=b.isChargeOrder,i=b.productIds||"";a.ajax({method:"POST",url:'/media/api2.go?action=multiAction&field={"dependActions":[{"action":"savePayment","params":{"cartId":"'+d+'","fromPlatform":"'+g+'","isPaperBook":"'+f+'","orderSource":"'+e+'"}},{"action":"submitOrder","params":{"cartId":"'+d+'","fromPlatform":"'+g+'","isChargeOrder":"'+h+'","isPaperBook":"'+f+'","orderSource":"'+e+'"}}]}&fromPaltform=ds_pc'+c.setBaseApiParams().replace("fromPlatform=106","fromPlatform="+g),success:function(a){if(a.data.errors)b.callback&&b.callback(),c.setMessageTip("消费失败！");else{var d=a.data.result.submitOrder.data.result;b.callback&&b.callback(),window.location.href=c.getHost()+"cart_result_page.html?payValue="+100*parseFloat(d.total)+"&productIds="+i}}})}}),define("useCoupon",["jquery","underscore","ddbase","savePayment"],function(a,b,c,d){return function(b){for(var e=b.fromPlatform,f=b.oneKeyBuy,g=b.orderSource,h=c.getCookie("__permanent_id")||"",i=b.products,j=b.isPaperBook,k=i.split(","),l=new Array,m=0,n=k.length;m<n;m++){var o=k[m].split("|"),p=o[1]?o[1]:o[0];l.push(p)}i=l.join(","),a.ajax({method:"POST",url:'/media/api2.go?action=multiAction&field={"dependActions":[{"action":"appendCart","params":{"fromPlatform":"'+e+'","oneKeyBuy":"'+f+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'","referType":"bookCity"},"parseParams":{"cartId":"cartId"}},{"action":"getOrderFlow","params":{"fromPlatform":"'+e+'","isPagerBook":"'+b.isPagerBook+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'"}},{"action":"useCoupon","params":{"barginTotal":"'+b.amount+'","fromPlatform":"'+e+'","oneKeyBuy":"'+f+'","orderSource":"'+g+'","order_sequence_id":"'+b.order_sequence_id+'","couponCode":"'+b.couponCode+'"}},{"action":"getOrderFlow","params":{"fromPlatform":"'+e+'","isPagerBook":"'+j+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'"}}]}&fromPaltform=ds_pc'+c.setBaseApiParams().replace("fromPlatform=106","fromPlatform="+b.fromPlatform),success:function(a){a.data.errors?(b.callback&&b.callback(),c.setMessageTip("消费失败！")):d({cartId:a.data.result.getOrderFlow.data.result.cart_id,orderSource:g,isPaperBook:j,fromPlatform:e,isChargeOrder:0,productIds:i,callback:b.callback})}})}}),define("useDdMoney",["jquery","underscore","ddbase","savePayment"],function(a,b,c,d){return function(b){for(var e=b.fromPlatform,f=b.oneKeyBuy,g=b.orderSource,h=c.getCookie("__permanent_id")||"",i=b.products,j=b.isPaperBook,k=i.split(","),l=new Array,m=0,n=k.length;m<n;m++){var o=k[m].split("|"),p=o[1]?o[1]:o[0];l.push(p)}i=l.join(","),a.ajax({method:"POST",url:'/media/api2.go?action=multiAction&field={"dependActions":[{"action":"appendCart","params":{"fromPlatform":"'+e+'","oneKeyBuy":"'+f+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'","referType":"bookCity"},"parseParams":{"cartId":"cartId"}},{"action":"getOrderFlow","params":{"fromPlatform":"'+e+'","isPagerBook":"'+b.isPagerBook+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'"}},{"action":"useDdMoney","params":{"amount":"'+b.amount+'","fromPlatform":"'+e+'","oneKeyBuy":"'+f+'","orderSource":"'+g+'","order_sequence_id":"'+b.order_sequence_id+'"}},{"action":"getOrderFlow","params":{"fromPlatform":"'+e+'","isPagerBook":"'+j+'","orderSource":"'+g+'","permanentId":"'+h+'","productIds":"'+i+'"}}]}&fromPaltform=ds_pc'+c.setBaseApiParams().replace("fromPlatform=106","fromPlatform="+b.fromPlatform),success:function(a){a.data.errors?(b.callback&&b.callback(),c.setMessageTip("消费失败！")):d({cartId:a.data.result.getOrderFlow.data.result.cart_id,orderSource:g,isPaperBook:j,fromPlatform:e,isChargeOrder:0,productIds:i,callback:b.callback})}})}}),define("buyMedia",["jquery","ddbase"],function(a,b){return function(c){var d=c.saleId,e=c.mediaId,f=c.cId;a.ajax({method:"POST",url:"/media/api2.go?action=buyMedia&consumeType=1&platform=3&saleId="+d+"&deviceVersion=html5&mediaId="+e+"&fromPaltform=ds_pc&cId="+f+b.setBaseApiParams().replace("fromPlatform=106","fromPlatform="+c.fromPlatform),success:function(a){0==parseInt(a.status.code)?(c.callback&&c.callback(),b.setMessageTip("购买成功，请去我的书架查看！")):(c.callback&&c.callback(),b.setMessageTip("购买失败，请稍后重试！"))}})}}),define("payMethordModule",["jquery","underscore","backbone","ddbase","payMethordModuleTemplate","purchaseEbookVirtualPaymentForPC","useCoupon","useDdMoney","buyMedia"],function(a,b,c,d,e,f,g,h,i){var j=j||{};return j.view=c.View.extend({events:{"click .sum_line .time":"showMore","click .buy_btn":"purchaseBook","click input":"selectPayMethord","click .cancle_btn":"hidePopModule"},initialize:function(b){var c=this;c.productIds=b.productIds,c.el=b.el,c.template=b.template,c.price="",c.mediaType=parseInt(b.mediaType),c.cId=b.cId,c.saleId=b.saleId,c.fromPlatform=b.fromPlatform||307,b.price&&(c.price=b.price),b.callback&&(c.callback=b.callback),b.devicetypecodes?c.devicetypecodes=b.devicetypecodes:c.devicetypecodes=null,b.mediaType&&1==b.mediaType?c.url='/media/api2.go?action=multiAction&field={"noDependActions":[{"action":"getAccount"}]}':c.url='/media/api2.go?action=multiAction&field={"noDependActions":[{"action":"getEbookOrderFlowV3","params":{"productIds":"'+c.productIds+'","fromPlatform":"106"}},{"action":"getAccount"},{"action":"getValidCoupon","params":{"isPaperBook":"false"}},{"action":"getDdMoneyList"}]}',c.render(),a(c.el).parent().find(".closeBtn").click(function(){c.hidePopModule()})},render:function(){var c=this;a.ajax({method:"POST",url:c.url+d.setBaseApiParams(),success:function(e){0==parseInt(e.status.code)?(e.data.result.getEbookOrderFlowV3&&0==parseInt(e.data.result.getEbookOrderFlowV3.status.code)?c.payable=e.data.result.getEbookOrderFlowV3.data.payable:c.payable=0,(e.data.result.getEbookOrderFlowV3&&e.data.result.getEbookOrderFlowV3.data.paymentProductList&&e.data.result.getEbookOrderFlowV3.data.paymentProductList.length>0||c.productIds)&&a(c.el).html(b.template(c.template)({data:e.data.result,deviceTypeCodes:c.devicetypecodes,price:c.price})),c.callback?c.callback():(a(".load_module").hide(),a(".payment_popUp_module").show())):d.setMessageTip("购买失败，请稍后重试！")}})},showMore:function(b){var c=a(b.currentTarget),d=c.parent().parent().parent();c.find(".down").length>0?(c.find(".down").addClass("up").removeClass("down"),d.find(".detail_list").show()):(c.find(".up").addClass("down").removeClass("up"),d.find(".detail_list").hide())},purchaseBook:function(b){var c=this,e=c.mediaType||2,j=a(b.currentTarget),k=a("#mediaId").val(),l=a("#saleId").val(),m=d.getQueryString("cId")||"";if(j.hasClass("rechargeBtn"))window.location.href.indexOf("pay_methord_page.html")<0&&d.setCookie("MDD_productArray",'[{"productId":"'+k+'","saleId":"'+l+'","cId":"'+m+'"}]',8760),window.location=d.getHost()+"recharge_methord_page.html?productIds="+k+"&cId="+m+"&mediaType="+e+"&fromPlatform="+c.fromPlatform;else{a(".load_module").show(),a("body").css({"overflow-y":"hidden"}),a(".payment_popUp_module").hide();var c=this,n=a('input[name="payment"]:checked').attr("data-role");if("account"==n&&(2===c.mediaType&&f({productIds:k,dayNum:0,isAppendBorrow:!1,orderSource:77e3,fromPlatform:c.fromPlatform,cId:m,callback:c.hideLoadMash,mediaType:c.mediaType,saleId:l}),1===c.mediaType)){var l=a("#saleId").val(),m=d.getQueryString("cId")||"";if(null==mediaId)return void d.setMessageTip("参数错误！");i({saleId:l,mediaId:k,cId:m,fromPlatform:c.fromPlatform,callback:c.hideLoadMash})}if("ddMoney"==n&&h({products:k,orderSource:77e3,fromPlatform:c.fromPlatform,order_sequence_id:"0_98",amount:parseInt(c.payable)/100,isPaperBook:!1,oneKeyBuy:!1,callback:c.hideLoadMash}),"couponMoney"==n){var o=a('input[name="validCoupon"]:checked');0==o.length?(c.hideLoadMash(),d.setMessageTip("请选择礼券!"),a(".payment_popUp_module").css({display:"block"}),a(".sum_line .time").click()):g({products:k,orderSource:77e3,fromPlatform:c.fromPlatform,oneKeyBuy:!1,order_sequence_id:"0_98",couponCode:o.attr("data-role"),barginTotal:parseInt(c.payable)/100,callback:c.hideLoadMash})}}},hideLoadMash:function(){a(".load_module").hide(),a(".payment_popUp_module").hide(),a("body").css({"overflow-y":""})},selectPayMethord:function(b){var c=a(b.currentTarget);a("input").removeAttr("checked"),c[0].checked=!0,"validCoupon"==c.attr("name")&&(a('input[data-role="couponMoney"]')[0].checked=!0),parseFloat(c.parent().parent().find(".account_money").attr("data-sum"))-parseFloat(a(".payable_num").text())>=0?a(".buy_btn").removeClass("rechargeBtn").html("购买"):a(".buy_btn").addClass("rechargeBtn").html("充值并购买")},hidePopModule:function(){a(".payment_popUp_module").hide()}}),j}),define("bar_module",["jquery","underscore","ddbase","loginModule","praise","enterBar"],function(a,b,c,d,e,f){document.domain="dangdang.com";var g={barId:a("#barId").val()},h=function(){var b=document.getElementById("ueditorIframe").contentWindow.document.getElementById("ueditor_0").contentWindow.document.body;return a(b).html()},i=function(b){var c=document.getElementById("ueditorIframe").contentWindow.document.getElementById("ueditor_0").contentWindow.document.body,d=a(c).text().length,e=a(c).find("img").length;return d&&e?1:d>0&&0==e?0:0==d&&e>0?2:void 0},j=function(){var b=document.getElementById("ueditorIframe").contentWindow.document.getElementById("ueditor_0").contentWindow.document.body;a(b).html(""),a("#postTitle").val("")},k=function(){var b=a("#postTitle").val(),d=h(),e=b.replace(/\s+/g,""),f=d.replace(/<br>|<p>|<\/p>|\s+|(&nbsp;)+/g,"");return e&&f?{barId:g.barId,mediaDigestId:"",title:b,content:d,cardType:i(d),actionType:"1"}:(c.setMessageTip("请填写完整"),!1)},l=function(){var b=k(),e=!1,f=!1;if(b){if(!c.token())return void c.setMessageTip("请先登录~");e=!0;4==a("#bar .bar_write_btn").attr("memberStatus")?(a("#mask").show(),a("#enterBar").show()):f=!0,e&&f&&a.ajax({url:"/media/api.go?action=publishRtfArticle"+c.baseApiParams,type:"post",data:b,success:function(a){return 10003==a.status.code?void d():0!=a.status.code?void c.setMessageTip(a.status.message+",发帖失败，请修改后重试！"):(j(),void c.setMessageTip("发帖成功"))}})}};return{init:function(b){var d=this;a("body").delegate(".commentBtn","click",l),a("body").delegate("#bar .bar_write_btn","click",function(a){d.writePosts(this)}),a("body").delegate(".product_barposts_module .favor","click",function(a){d.favor(this)}),a("body").delegate("#enterBar .pop_btn","click",function(a){d.enterBarFn(this)}),a.get("/media/api.go?action=queryArticleListV2"+c.baseApiParams,{objectId:b.mediaId},function(b){0==b.status.code&&(a("#bar .bar_write_btn").attr("memberStatus",b.data.barInfo.memberStatus),1==b.data.barInfo.memberStatus&&a("#bar .bar_write_btn").text("已加入"))})},favor:function(b){var c=a(b),d=c.attr("digestId");e.init({url:"/media/api2.go?action=praiseComment&commentType=1&isAnonymous=1",targetId:d,targetSource:1e3,el:c})},writePosts:function(b){var e=a(b);barId=e.attr("barId");var f=e.attr("memberStatus");""==c.token()?d():4==f?(a("#mask").show(),a("#enterBar").show()):c.setMessageTip("您已经是吧成员")},enterBarFn:function(b){0==a(b).attr("status")?(a("#mask").hide(),a("#enterBar").hide()):f.init({url:"/media/api.go?action=barMember",actionType:1,barId:g.barId,callBack:function(){},btn:"#bar .bar_write_btn"})}}}),define("lazyloadForHover",["jquery"],function(a){var b={};return b.init=function(a){var b=this;b.el=a.el,b.tabChange(b.el)},b.tabChange=function(b){a(b).each(function(){var b=a(this).find(".list_title li"),c=a(this).find(".list_content"),d=c.find(".nopic");c.each(function(){a(this).children(":first").addClass("current").end().siblings("list_content").addClass("hide");var b=a(this).children().eq(0).find(".cover img[data-hover]"),c=b.data("hover");b.attr("src",c).data("status","1")});var e=c.eq(0).children().eq(0).find(".cover img"),f=e.data("hover");e.eq(0).attr("src",f),e.data("status","1"),3==b.length&&b.hover(function(){switch(a(this).addClass("selected").siblings().removeClass("selected"),a(this).index()){case 0:c.eq(0).show().siblings(".list_content").hide(),c.eq(0).children().removeClass("current").eq(0).addClass("current");var b=c.eq(0).children().eq(0).find(".cover img"),d=b.data("hover");b.eq(0).attr("src",d),b.data("status","1");break;case 1:c.eq(2).show().siblings(".list_content").hide(),c.eq(2).children().removeClass("current").eq(0).addClass("current");var b=c.eq(2).children().eq(0).find(".cover img"),d=b.data("hover");b.eq(0).attr("src",d),b.data("status","1");break;case 2:c.eq(1).show().siblings(".list_content").hide(),c.eq(1).children().removeClass("current").eq(0).addClass("current");var b=c.eq(1).children().eq(0).find(".cover img"),d=b.data("hover");b.eq(0).attr("src",d),b.data("status","1")}}),3!==b.length&&b.hover(function(){a(this).addClass("selected").siblings().removeClass("selected");var b=a(this).index();c.eq(b).show().siblings(".list_content").hide(),c.eq(b).children().removeClass("current").eq(0).addClass("current");var d=c.eq(b).children().eq(0).find(".cover img"),e=d.data("hover");d.eq(0).attr("src",e),d.data("status","1")}),d.hover(function(){a(this).addClass("current").siblings().removeClass("current");var b=a(this).find(".cover img"),c=b.data("hover");b.eq(0).attr("src",c),b.data("status","1")})})},b}),define("hotChannel",["jquery","underscore","backbone","ddbase"],function(a,b,c,d){var e={};return e.module=c.Model.extend({defaults:{mediaList:[{authorPenname:"",coverPic:"",mediaId:"",mediaType:"",saleId:"",subTitle:"",title:""}]}}),e.collection=c.Collection.extend({model:e.module}),e.view=c.View.extend({initialize:function(a){var b=this;b.el=a.el,b.dataUrl=a.dataUrl+d.baseApiParams+"&mediaId="+d.getQueryString("id"),b.template=a.template,b.collection=new e.collection,b.render()},render:function(){var c=this;c.collection.fetch({url:c.dataUrl,success:function(d,e){0==e.status.code&&(c.collection.set(e.data.channelList),a(c.el).html(b.template(c.template)({data:c.collection})))},error:function(){}})}}),e}),define("hotChannelTemplate",[],function(){return'<%if(data.length>0){%><div class="product_rectitle_module">热门频道</div><div class="hot_channel_wrap"><%data.each(function(item){%><div class="hot_channel_list"><a href="channeldetail_page.html?cId=<%=item.get("channelId")%>" title="<%=item.get("title")%>" target="_blank"><em class="img_wrap"><img src="<%=item.get("icon")%>" alt=""><span><%=item.get("subNumber")%>人订阅</span></em><div class="grey_bg"><h4><%=item.get("title")%></h4><p><%=item.get("description")%></p></div></a></div>\t<%})%></div><%}%>'}),define("indexSearch",["jquery","underscore","ddbase"],function(a,b,c){var d={data:{url:"/media/api2.go?action=searchSug&type=1&keyword=",hotWordUrl:"/media/api.go?action=block&code=search_words"},getCookieValue:function(a){if(""==a||"null"==a)return"";var b=a.split(","),c="";if(b.length>0){for(var d=0;d<b.length;d++)""==b[d]?b.splice(d,1):c+=b[d]+",";return c}return""},uniquelCookie:function(a,b){b=b.split(",");for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},searchBtn:function(b,e,f){if(a(".delAll").remove(),d.uniquelCookie(b,e)||(""!=e?""!=b&&b.length<15?(e=b+","+e,e=e.substring(0,e.length-1),c.setCookie("bookName",e,24,"e.dangdang.com")):c.setCookie("bookName",e,24,"e.dangdang.com"):""!=b&&b.length<15&&(e=b,c.setCookie("bookName",e,24,"e.dangdang.com"))),!f){if(""!=b){var g=a(".new_searchtext").attr("default");g!=b&&(g=b),window.open("/newsearchresult_page.html?keyword="+encodeURIComponent(g))}return!1}var g=a(".new_searchtext").attr("default");g!=b&&(g=b),window.location.href="/newsearchresult_page.html?keyword="+encodeURIComponent(g)},history:function(b){if("null"!=b&&""!=b&&void 0!=b){var c=b.split(",");c=c.length>10?c.slice(0,10):c.slice(0);var e={},f={};f.sugs=[];for(var g=0;g<c.length;g++)if(""!=c[g]){var h={};h.freq=0,h.sug=c[g],f.sugs.push(h)}e.data=f,a(".delAll")&&a(".delAll").remove(),d.setHisDate(a(".new_list"),a(".new_list li"),e),a(".new_list li").css("color","#42abff"),a(".new_list li").hover(function(){"搜索历史"==a(this).find("em").text()?a(this).find("em").html("删除").css("color","#009cff"):a(this).find("em").html("搜索历史").css("color","#a1a1a1")})}},setData:function(a,c,d,e){var f=b.template(a.html());d.remove(),c.append(f(e))},setHisDate:function(c,d,e){var f="<%_.each(data.sugs,function(item,i){%><li><%=item.sug%><em>搜索历史</em></li><%})%>",g=b.template(f);d.remove(),c.append(g(e)),a(".new_list").append("<p class='delAll'>删除全部</p>")},hotWordSuccess:function(b){if(0==b.status.code){b=JSON.parse(b.data.block.replace(/\r\n/gi,""));var e=b.hotwords,f=b.defult;a(".new_search input").attr("default",f);-1==window.location.href.indexOf("keyword")&&a(".new_search input").val(f);var g=new RegExp("[;]","g");e=e.replace(g," ");var h=/\s+/g;e=e.replace(h,",").split(",");for(var i="",j=0;j<e.length;j++){var k=e[j].match(/\<[^\}]+\>/);k?(k=k[0],k=k.slice(1,k.length),k=k.slice(0,k.length-1),i+='<a data-href="'+k+'">'):i+="<a>",i+=e[j],i+="</a>"}a(".hotword").html("<em>搜索热词：</em>"+i),a(".hotword a").click(function(){var b=unescape(c.getCookie("bookName")),e=d.getCookieValue(b),f=a(this).text();d.uniquelCookie(f,e)||(e=f+","+e,e=e.substring(0,e.length-1),c.setCookie("bookName",e,24,"e.dangdang.com")),a(this).attr("data-href")?window.open(a(this).attr("data-href")):window.open("/newsearchresult_page.html?keyword="+encodeURIComponent(a(this).text()))})}},init:function(b){var e=this;if(b)var f=b.freshCurPage;var g=-1,h="";e.ajaxFn("Get",e.data.hotWordUrl,e.hotWordSuccess,e.hotWordError),a(".new_search").click(function(b){if(b.target=b.target||b.srcElement,"LI"==b.target.nodeName){var e=a.trim(a(b.target).text().replace("搜索历史","").replace("删除",""));a(this).find("input").val(e);var g=unescape(c.getCookie("bookName"));l=d.getCookieValue(g),d.searchBtn(e,l,f),a(this).find("ul li").css("display","none")}else if("SPAN"==b.target.nodeName){var g=unescape(c.getCookie("bookName"));l=d.getCookieValue(g);var h=a(".new_searchtext").val();d.searchBtn(h,l,f)}else if("EM"==b.target.nodeName&&"删除"==b.target.innerText){var i=a.trim(a(b.target).parent().text().replace("搜索历史","").replace("删除",""));a(b.target).parents("ul").css("display","block");var g=unescape(c.getCookie("bookName")),j=g.split(",");if(null!=g&&""!=g&&void 0!=g){j=j.length>10?j.slice(0,10):j.slice(0);for(var k=0;k<j.length;k++)i==j[k]&&(j.splice(k,1),k--);for(var l="",k=0;k<j.length;k++)l+=j[k]+",";l=l.substring(0,l.length-1),c.setCookie("bookName",l,24,"e.dangdang.com")}a(b.target).parent().remove(),0==a(".new_list li").length&&a(".delAll").remove()}else"P"==b.target.nodeName&&(c.setCookie("bookName","",24,"e.dangdang.com"),a(".new_list")[0].style.display="none")}).mouseout(function(b){var c=a(".new_searchtext").attr("default");c==a(".new_searchtext").val()&&a(".new_searchtext").val(c),b=b||window.event;var d=b.toElement||b.relatedTarget;this.contains(d)||(a(".new_list")[0].style.display="none")}),a(".new_searchtext").bind("input propertychange",function(){a(".new_list li").remove(),a(".delAll").remove(),a(".new_list")[0].style.display="block";var b=a(this).val(),f=unescape(c.getCookie("bookName"));""==b?""==f||"null"==f||void 0==f?(a(".new_list li").remove(),a(".delAll").remove()):d.history(f):e.showDetail(b)}).keyup(function(a){a=a||window.event,38==a.keyCode&&-1==g&&a.preventDefault()}).keydown(function(b){var e=b.keyCode;if(38==e){g-=1,g<=-1&&(g=a(".new_list li").length-1),a(".new_list li").eq(g).addClass("cur").siblings().removeClass("cur");var i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除","");a(this).val(i)}else if(40==e)g+=1,g==a(".new_list li").length&&(g=0),a(".new_list li").eq(g).addClass("cur").siblings().removeClass("cur"),i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除",""),a(this).val(i);else if(13==e){b.stopPropagation(),a(".new_list li").hasClass("cur")?(i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除",""),a(this).val(i)):i=a(this).val();var j=unescape(c.getCookie("bookName"));h=d.getCookieValue(j),d.searchBtn(i,h,f)}}).focus(function(){a(".new_list")[0].style.display="block";var b=a(this).val(),f=a(this).attr("default");f==b&&(a(this).val(""),b=f);var g=unescape(c.getCookie("bookName"));h=d.getCookieValue(g),""==b?""==g||"null"==g||void 0==g?(a(".new_list li").remove(),a(".delAll").remove()):d.history(g):e.showDetail(b)})},showDetail:function(a){var b=this;b.ajaxFn("Get",b.data.url+a,b.showDetialSuc,b.showDetialError)},ajaxFn:function(b,c,d,e){a.ajax({url:c,type:b,dataType:"json",success:function(a){d(a)},error:function(a){e()}})},showDetialSuc:function(c){var d="<%_.each(data.sugs,function(item,i){%><li><%=item.sug%> </li><%})%>",e=b.template(d);a(".new_list li").remove(),a(".new_list").append(e(c))},showDetialError:function(){console.log("接口错误")}};return d}),require(["jquery","underscore","ddbase","productBooklistModule","collect_","productBarTemplate","productBarpostsTemplate","productBar","share_","loginModule","publicMethodNew","originalAlsoBuyTemplate","recommendTopTemplate","quickPayMethordModuleTemplate","payMethordModule","loginWindow","bar_module","lazyloadForHover","hotChannel","hotChannelTemplate","indexSearch"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(){var b=setting.id,d=a("#buy_now_button");if(a(".load_module").show(),null!=b){new o.view({template:n,el:a(".payment_popUp_module .popUp_detail"),productIds:b,callback:w,devicetypecodes:d.attr("devicetypecodes"),mediaType:setting.mediaType,mediaId:setting.mediaId,cId:setting.cId,price:d.attr("data-price"),fromPlatform:306})}else a(".load_module").hide(),c.setMessageTip("参数错误！")}function w(){a(".load_module").hide(),a(".payment_popUp_module").show()}k.init(),u.init(),setting={},setting.id=a("#saleId").val(),setting.mediaId=a("#mediaId").val(),setting.mediaType=a("#mediaType").val(),setting.cId=c.getQueryString("cId")||"",a("#content").delegate(".categorysbtn","click",function(){window.open("http://e.dangdang.com/original_product_catalog_page.html?mediaId="+setting.mediaId,"_blank")}),a("#content").delegate("#buy_now_button","click",function(){if(""==c.token())return showMsgBox("buy_now_button","","",v),!1;v()}),a("#content").delegate(".readbtn","click",function(){window.open("http://e.dangdang.com/pc/reader/index.html?id="+setting.mediaId,"_blank")});var x='<div class="title">图书很赞，犒劳一下</div><div class="tableC"><table><% _.each(rewardList,function(item){%><tr><td><div title="<%=item.username%>"><%=item.username%></div></td><td><div><i class="icon ring"></i><%=item.cons%></div></td></tr><%})%></table></div><div class="counts">累计捧场<%=totalConis%></div>',y='<table><tr><td colspan="2" class="title">图书很赞，犒劳一下</td></tr><tr><td colspan="2"><img src="img/original_single/nodata.png" style="  border: 1px solid #d4d7da;position: relative;left: -10px;top: 18px;border:1px solid #d4d7da;"/></td></tr></table>',z=function(){a.get("/media/api.go?action=getMediaRewardRecord"+c.baseApiParams,{saleId:setting.id,count:7},function(b){if(0==b.status.code){if(0==b.data.rewardList.length)var d=c.template(y,{});else var d=c.template(x,b.data);a("#supportlist").html(d)}})},A=function(b){a("#recharge_pop .no.pop_btn").click(function(){a("#mask_recharge").hide(),a("#recharge_pop").hide()}),a.get("/media/api.go?action=getAccount"+c.baseApiParams,function(b){if(0==b.status.code){var c=b.data.account,d=(c.attachAccountMoney,c.masterAccountMoney,a("#go_to_recharge").attr("href"));a("#go_to_recharge").attr("href",d+"?fromPlatform=310&mediaType="+setting.mediaType),a("#mask_recharge").show(),a("#recharge_pop").show()}})};a(".rings li").bind("click",function(){a(".rings li").removeClass("focus"),a(this).addClass("focus");var b=a(this).attr("data-rings");0==b?(a(".opration input").focus(),a(".opration input").val(""),a(".opration .sum").text(b)):(a(".opration input").val(b),a(".opration .sum").text(b))}),a(".opration input").bind("keyup",function(){var b=a(this).val();/^[1-9]\d*$/.test(b)||(b=b.substring(0,b.length-1),a(this).val(b)),b||(b=0),a(".opration .sum").text(b)}),a(".support .supportbtn").bind("click",function(){c.token();if(!c.token())return void j();var b=a("#supportNum").val();if(!b)return c.setMessageTip("请输入打赏铃铛数"),void a(".opration input").focus();a.get("/media/api.go?action=reward"+c.baseApiParams,{saleId:setting.id,cons:b},function(d){var e="";switch(d.status.code){case 0:e='<i class="icon supportsuccess"></i>多谢亲壕赏，我以后会更加努力的哈~~',z(),c.setMessageTip(e);break;case 15801:e='<i class="icon supportfail"></i>现实比理想骨感，余额不足耶~',A(b);break;default:e='<i class="icon supportfail"></i>打赏失败，请稍后重试~~',c.setMessageTip(e)}setTimeout(function(){a("#supportMessage").hide().html("")},3e3)})}),a.get("/media/api.go?action=getMedia"+c.baseApiParams,{refAction:"browse",saleId:setting.id},function(b){if(0==b.status.code){var c=b.data.mediaSale.mediaList[0],d="";1===c.isSupportFullBuy&&0===c.isWholeAuthority&&(d='<div class="button salebtn" id="buy_now_button" deviceTypeCodes="pconline|android|iphone" data-price="'+c.price+'">一键购买</div>'),a("#content .buttons").prepend(d),a("#collectC").attr("data-isstore",c.isStore),B()}}),z();var B=function(){e.render({el:"#collectC",isStore:a("#collectC").attr("data-isstore"),collectId:setting.mediaId,mediaType:setting.mediaType}),i.render({el:"#ShareC",title:a("#product_title").val(),desc:a("#product_desc").val(),pic:a("#product_coverPic").val()})};q.init({mediaId:setting.mediaId}),r.init({el:".publish_seller_list"})}),define("original_single_",function(){});